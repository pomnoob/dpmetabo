---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r transpose}
library(tidyverse)
#import mean concentraiton data in postive mode
posmean_sub <- read_csv("posmean_sub.csv")
#import compound id data file
pos_comid <- read_csv("pos_comid.csv")
#select subjects only, exclude QC and Mean values
posmean_eq <- dplyr::select(posmean_sub,id,matches("^[ABCD]"))
#Transpose data frame:subjects in row
posmean <- posmean_eq %>%
  rename(metid=id) %>%
  gather(subid,value,-metid) %>%
  spread(metid,value)
#Change format of subject id and add treatment class for each row
subid2 <- posmean$subid %>% str_replace("[0-9][0-9]_pos\\.[ABCD]","_")
treat <- rep(c("Adiet","Bdiet","Cdiet","Ddiet"),times=c(16,16,18,18))
posmean_group <- posmean %>% dplyr::select(-subid) %>% add_column(subid=subid2,treatment=treat) %>% dplyr::select(subid,treatment,everything())
```

```{r normalization}
library(MetaboAnalystR)
write_csv(posmean_group,"posmean_group.csv")
#set up method project 
mSet<-InitDataObjects("conc", "stat", FALSE)
#samples in row not paired
mSet<-Read.TextData(mSet, "posmean_group.csv", "rowu", "disc");
mSet<-SanityCheckData(mSet)
mSet<-ReplaceMin(mSet);
mSet<-PreparePrenormData(mSet)
#normalization using reference feature,log transformation,auto normalization
mSet<-Normalization(mSet, "CompNorm", "LogNorm", "AutoNorm", ref="722", ratio=FALSE, ratioNum=20)
mSet<-PlotNormSummary(mSet, "norm_0_", "png", 72, width=NA)
mSet<-PlotSampleNormSummary(mSet, "snorm_0_", "png", 72, width=NA)
#export normalized data
normal <- mSet[["dataSet"]][["norm"]]
```

```{r data-summary}



```


